{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# eBrain examples: vim-2\n",
    "\n",
    "– by http://www.ccnlab.net ––\n",
    "\n",
    "\n",
    "This notebook demonstrates how an encoding model can be applied on real video data. We use the publically available vim-2 fMRI data set from the Gallant lab.\n",
    "\n",
    "Dataset available from https://crcns.org/data-sets\n",
    "Dataset info from https://crcns.org/files/data/vim-2/crcns-vim-2-readme.pdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "## Set your ebrain base directory ***\n",
    "import os\n",
    "os.chdir('/vol/ccnlab-scratch1/egrant/ebrain')\n",
    "\n",
    "import numpy as np\n",
    "import h5py\n",
    "import skimage.transform\n",
    "from encoding_models.encoding_model import EncodingModel\n",
    "from feature_models.gabor_wavelet_pyramid import GaborWaveletPyramid\n",
    "from feature_models.convolutional_neural_network import CNN\n",
    "from feature_models.identity import Identity\n",
    "from response_models.kernel_ridge_regression import KernelRidgeRegression\n",
    "from encoding_models.ring_buffer import RingBuffer\n",
    "from matplotlib import pyplot as plt\n",
    "import tables\n",
    "import scipy.io"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\n",
    "Import data from the VIM-2 dataset. We choose voxels from the region of interest (ROI) V1LH."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Importing data (May take some time)\n",
      "Cleaning  data\n"
     ]
    }
   ],
   "source": [
    "print('Importing data (May take some time)')\n",
    "f = tables.open_file('/vol/ccnlab-scratch1/egrant/ebrain/Data/VIM2/VoxelResponses_subject1.mat')\n",
    "f.listNodes # Show all variables available\n",
    "data_train = f.get_node('/rt')[:]\n",
    "data_val = f.get_node('/rv')[:]\n",
    "roi = f.get_node('/roi/v1lh')[:].flatten()\n",
    "v1lh_idx = np.nonzero(roi==1)[0]\n",
    "V1LHresp_train = data_train[v1lh_idx].T\n",
    "V1LHresp_val = data_val[v1lh_idx].T\n",
    "Stimuli= h5py.File('/vol/ccnlab-scratch1/egrant/ebrain/Data/VIM2/Stimuli.mat')\n",
    "stim_train = Stimuli['st'][0::15,:,:,:].astype('float')/255.0 #15Hz\n",
    "stim_val = Stimuli['sv'][0::15,:,:,:].astype('float')/255.0 #15Hz\n",
    "#convert video to grayscale and resize\n",
    "stim_train=0.21*stim_train[:,0,:,:]+0.72*stim_train[:,1,:,:]+0.07*stim_train[:,2,:,:]\n",
    "stim_val=0.21*stim_val[:,0,:,:]+0.72*stim_val[:,1,:,:]+0.07*stim_val[:,2,:,:]\n",
    "stim_train=np.transpose(stim_train,(1,2,0))\n",
    "stim_val=np.transpose(stim_val,(1,2,0))\n",
    "stim_train = skimage.transform.resize(stim_train, (64, 64))\n",
    "stim_val = skimage.transform.resize(stim_val, (64, 64))\n",
    "stim_train=np.transpose(stim_train,(2,0,1))\n",
    "stim_val=np.transpose(stim_val,(2,0,1))\n",
    "#Reshape\n",
    "stim_train=np.reshape(stim_train,(stim_train.shape[0],stim_train.shape[1]*stim_train.shape[2]))\n",
    "stim_val=np.reshape(stim_val,(stim_val.shape[0],stim_val.shape[1]*stim_val.shape[2]))\n",
    "del Stimuli #Cleanup\n",
    "del f\n",
    "del data_train\n",
    "del data_val\n",
    "\n",
    "\n",
    "## Clean response data\n",
    "print('Cleaning  data')\n",
    "mask = (np.nan_to_num(V1LHresp_val) != 0 ).all(axis=0) | (np.nan_to_num(V1LHresp_train) != 0 ).all(axis=0)\n",
    "V1LHresp_train=V1LHresp_train[:,mask]\n",
    "V1LHresp_train[np.isnan(V1LHresp_train)]=0\n",
    "V1LHresp_val=V1LHresp_val[:,mask]\n",
    "V1LHresp_val[np.isnan(V1LHresp_val)]=0\n",
    "\n",
    "\n",
    "## Select n random voxels for demo set\n",
    "n_vox=V1LHresp_train.shape[1]   #set to 'V1LHresp_train.shape[1]' for all voxels\n",
    "np.random.seed(0)\n",
    "target_vox=np.random.randint(n_vox, size=n_vox)\n",
    "V1LHresp_train=V1LHresp_train[:,target_vox]\n",
    "V1LHresp_val=V1LHresp_val[:,target_vox]\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\n",
    "Now let's create, fit and predict with an EncodingModel object:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {
    "collapsed": false,
    "scrolled": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Creating encoding model\n",
      "Training encoding model\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (a / c): 1 / 1\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 1 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 2 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 3 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 4 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 5 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 6 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 7 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 8 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 9 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 10 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 11 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 12 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 13 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 14 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 15 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 16 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 17 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 18 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 19 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 20 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 21 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 22 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 23 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 24 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 25 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 26 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 27 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 28 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 29 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 30 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 31 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 32 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 33 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 34 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 35 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 36 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 37 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 38 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 39 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 40 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 41 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 42 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 43 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 44 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 45 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 46 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 47 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 48 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 49 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 50 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 51 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 52 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 53 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 54 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 55 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 56 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 57 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 58 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 59 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 60 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 61 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 62 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 63 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 64 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 65 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 66 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 67 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 68 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 69 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 70 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 71 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 72 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 73 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 74 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 75 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 76 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 77 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 78 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 79 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 80 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 81 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 82 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 83 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 84 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 85 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 86 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 87 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 88 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 89 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 90 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 91 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 92 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 93 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 94 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 95 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 96 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 97 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 98 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 99 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 100 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 101 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 102 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 103 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 104 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 105 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 106 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 107 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 108 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 109 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 110 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 111 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 112 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 113 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 114 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 115 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 116 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 117 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 118 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 119 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 120 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 121 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 122 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 123 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 124 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 125 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 126 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 127 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 128 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 129 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 130 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 131 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 132 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 133 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 134 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 135 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 136 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 137 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 138 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 139 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 140 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 141 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 142 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 143 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 144 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 145 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 146 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 147 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 148 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 149 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 150 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 151 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 152 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 153 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 154 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 155 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 156 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 157 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 158 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 159 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 160 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 161 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 162 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 163 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 164 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 165 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 166 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 167 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 168 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 169 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 170 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 171 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 172 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 173 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 174 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 175 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 176 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 177 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 178 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 179 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 180 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 181 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 182 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 183 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 184 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 185 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 186 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 187 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 188 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 189 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 190 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 191 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 192 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 193 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 194 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 195 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 196 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 197 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 198 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 199 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 200 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 201 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 202 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 203 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 204 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 205 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 206 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 207 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 208 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 209 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 210 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 211 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 212 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 213 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 214 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 215 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 216 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 217 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 218 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 219 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 220 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 221 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 222 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 223 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 224 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 225 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 226 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 227 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 228 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 229 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 230 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 231 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 232 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 233 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 234 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 235 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 236 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 237 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 238 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 239 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 240 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 241 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 242 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 243 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 244 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 245 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 246 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 247 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 248 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 249 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 250 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 251 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 252 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 253 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 254 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 255 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 256 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 257 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 258 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 259 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 260 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 261 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 262 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 263 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 264 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 265 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 266 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 267 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 268 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 269 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 270 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 271 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 272 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 273 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 274 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 275 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 276 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 277 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 278 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 279 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 280 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 281 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 282 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 283 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 284 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 285 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 286 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 287 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 288 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 289 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 290 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 291 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 292 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 293 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 294 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 295 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 296 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 297 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 298 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 299 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 300 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 301 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 302 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 303 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 304 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 305 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 306 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 307 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 308 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 309 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 310 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 311 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 312 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 313 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 314 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 315 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 316 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 317 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 318 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 319 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 320 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 321 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 322 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 323 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 324 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 325 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 326 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 327 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 328 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 329 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 330 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 331 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 332 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 333 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 334 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 335 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 336 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 337 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 338 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 339 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 340 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 341 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 342 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 343 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 344 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 345 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 346 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 347 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 348 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 349 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 350 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 351 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 352 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 353 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 354 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 355 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 356 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 357 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 358 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 359 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 360 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 361 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 362 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 363 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 364 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 365 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 366 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 367 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 368 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 369 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 370 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 371 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 372 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 373 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 374 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 375 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 376 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 377 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 378 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 379 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 380 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 381 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 382 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 383 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 384 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 385 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 386 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 387 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 388 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 389 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 390 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 391 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 392 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 393 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 394 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 395 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 396 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 397 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 398 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 399 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 400 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 401 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 402 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 403 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 404 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 405 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 406 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 407 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 408 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 409 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 410 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 411 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 412 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 413 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 414 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 415 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 416 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 417 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 418 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 419 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 420 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 421 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 422 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 423 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 424 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 425 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 426 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 427 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 428 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 429 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 430 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 431 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 432 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 433 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 434 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 435 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 436 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 437 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 438 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 439 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 440 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 441 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 442 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 443 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 444 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 445 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 446 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 447 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 448 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 449 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 450 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 451 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 452 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 453 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 454 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 455 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 456 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 457 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 458 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 459 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 460 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 461 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 462 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 463 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 464 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 465 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 466 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 467 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 468 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 469 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 470 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 471 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 472 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 473 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 474 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 475 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 476 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 477 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 478 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 479 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 480 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 481 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 482 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 483 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 484 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 485 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 486 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 487 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 488 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 489 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (b / c): 490 / 490\n",
      "'TRAIN_LINEAR_KERNEL_RIDGE_REGRESSION (c / c): 1 / 1\n",
      "Predicting validation responses\n",
      "PREDICT_LINEAR_KERNEL_RIDGE_REGRESSION: 1 / 1\n"
     ]
    }
   ],
   "source": [
    "## Define encoding model\n",
    "print('Creating encoding model')\n",
    "#weights='/vol/ccnlab-scratch1/egrant/ebrain/Data/vgg16_weights.h5' #path to CNN weights\n",
    "#fm=CNN(weights) #CNN feature model\n",
    "fm=Identity() #Identity feature model\n",
    "#fm=GaborWaveletPyramid() #GWP feature model\n",
    "rm=KernelRidgeRegression() #Response model\n",
    "buff_size=5 #Size of ring buffer\n",
    "em=EncodingModel(fm,rm,buff_size)\n",
    "\n",
    "\n",
    "## Fit encoding model \n",
    "print('Training encoding model')\n",
    "em.fit(stim_train,V1LHresp_train)\n",
    "\n",
    "\n",
    "## Predict encoding model \n",
    "print('Predicting validation responses')\n",
    "V1LHresp_val_hat=em.predict(stim_val)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "collapsed": true
   },
   "source": [
    "Align randomized stimuli with responses and remove insignificant voxels. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "## Align responses with buffer features\n",
    "V1LHresp_val=V1LHresp_val[em.val_feature_idx[:,0]+buff_size-1,:] \n",
    "\n",
    "\n",
    "## Remove insignificant voxels\n",
    "significant_vox=em.rm.H_0==False\n",
    "V1LHresp_val=V1LHresp_val[:,np.squeeze(significant_vox)]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Analyze encoding performance"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Analyzing encoding performance\n",
      "\n",
      "sigfniciant voxels: 469 / 490 at alpha = 0.00025\n",
      "encoding performance:  0.0379735022429  (mean R)\n"
     ]
    }
   ],
   "source": [
    "\n",
    "## Analyze encoding performance\n",
    "#Get num of significant voxels\n",
    "print('Analyzing encoding performance')\n",
    "print '\\nsigfniciant voxels:',n_vox-np.sum(em.rm.H_0),'/', n_vox, 'at alpha =',em.rm.alpha\n",
    "\n",
    "\n",
    "## Row-wise Correlation Coefficient calculation for two 2D arrays:\n",
    "def corr2_coeff(A,B):\n",
    "    # Rowwise mean of input arrays & subtract from input arrays themeselves\n",
    "    A_mA = A - A.mean(1)[:,None]\n",
    "    B_mB = B - B.mean(1)[:,None]\n",
    "    # Sum of squares across rows\n",
    "    ssA = (A_mA**2).sum(1);\n",
    "    ssB = (B_mB**2).sum(1);\n",
    "    # Finally get corr coeff\n",
    "    return np.dot(A_mA,B_mB.T)/np.sqrt(np.dot(ssA[:,None],ssB[None]))\n",
    "    \n",
    "# Get prediction / ground truth voxel correlations\n",
    "R = np.diagonal(corr2_coeff(V1LHresp_val.T,V1LHresp_val_hat[0].T))\n",
    "\n",
    "\n",
    "if V1LHresp_val_hat[0].shape[1]==0:\n",
    "    print 'no responses can be predicted at this alpha setting'\n",
    "else:\n",
    "    print 'encoding performance: ',np.mean(R),' (mean R)'\n",
    "    # Plot encoding performance Pyplot \n",
    "    fig = plt.figure()\n",
    "    plt.plot(np.arange(len(R))+1,sorted(R, reverse=True))\n",
    "    fig.suptitle('encoding performance')\n",
    "    plt.xlabel('voxel')\n",
    "    yLab=plt.ylabel('R')\n",
    "    yLab.set_rotation(0)\n",
    "    plt.ylim(-1, 1)\n",
    "    plt.xscale('log')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Analyze identification performance."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "identification performance:  241.684701493 / 536 (mean ranking)\n"
     ]
    }
   ],
   "source": [
    "# Get identification accuracy\n",
    "dPoints=V1LHresp_val.shape[0]\n",
    "ranking=np.zeros(dPoints)\n",
    "for i in range(0,dPoints):\n",
    "    C=corr2_coeff (np.expand_dims(V1LHresp_val_hat[0][i,:],axis=1).T ,  V1LHresp_val)\n",
    "    ranking[i]=np.sum(C>C[:,i])+1\n",
    "print 'identification performance: ',np.mean(ranking),'/',V1LHresp_val.shape[0], '(mean ranking)'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 2",
   "language": "python",
   "name": "python2"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
